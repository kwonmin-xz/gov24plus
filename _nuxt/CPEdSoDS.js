import{_ as le}from"./BIaB0Pf5.js";import{_ as ue}from"./D5CSCo7T.js";import{_ as de}from"./BrbkMlBl.js";import{q as C,d as me,s as fe,r as f,D as pe,A as he,V as ge,o as R,c as U,a as s,e as w,h as V,H as $,b as M,K as ye,F as be,O as Ce,B as v}from"./DSfHGzKa.js";import{o as P,a as j,c as we}from"./CGsc0nvB.js";import{u as ve,a as x}from"./CmU9jSgn.js";async function Se(p){const h=C().public.userApiUrl,o=await fetch(`${h}/nlogin/authUpCert`,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify(p)});if(!o.ok)throw new Error(`서버 에러: ${o.status}`);return await o.json()}async function ke(p){const h=C().public.userApiUrl,o=await fetch(`${h}/nlogin/authUpCert`,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify(p)});if(!o.ok)throw new Error(`서버 에러: ${o.status}`);return await o.json()}async function O(p){const h=C().public.userApiUrl,o=await fetch(`${h}/nlogin/authUpCert`,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify(p)});if(!o.ok)throw new Error(`서버 에러: ${o.status}`);return await o.json()}async function Ne(p){const h=C().public.userApiUrl,o=await fetch(`${h}/nlogin/authUpCert`,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify(p)});if(!o.ok)throw new Error(`서버 에러: ${o.status}`);return await o.json()}const Re={key:0,id:"UI-PT-CAM01P",role:"dialog","aria-modal":"true",class:"iw-modal xsm on"},Me={class:"modal-wrap"},Ue=me({__name:"AuthenticationModal",props:{visible:{type:Boolean},rrno:{},encRrno:{},crno:{},brno:{},userNm:{}},emits:["auth-result","close-modal"],setup(p,{emit:h}){const o=fe(),g=f(),b=f(null);function I(n){n!=="close-modal"&&m("auth-result",{success:!1,authMethod:"simple",message:"간편인증에 실패하였습니다.",rrno:e.rrno,encRrno:e.encRrno,crno:e.crno,brno:e.brno,userNm:e.userNm})}function B(){g.value.openModal()}function K(n){L(n)}async function L(n){try{const t=C().public.memberApiUrl,c=await(await fetch(t+"/oacx/parse_token",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)})).json();if(c.data.rrno===e.rrno){const l=await Se({loginTypeCd:"02",rrno:e.rrno||"",encRrno:e.encRrno||"",crno:e.crno||"",brno:e.brno||"",userNm:e.userNm||"",userCi:c.data.ci}),u=f(!1);l.status==="fail"?u.value=!1:u.value=!0,o.setRefreshUser(),m("auth-result",{success:u.value,authMethod:"simple",message:l.message,rrno:e.rrno,encRrno:e.encRrno,crno:e.crno,brno:e.brno,userNm:e.userNm})}else m("auth-result",{success:!1,authMethod:"simple",message:"간편인증에 실패하였습니다.",rrno:e.rrno,encRrno:e.encRrno,crno:e.crno,brno:e.brno,userNm:e.userNm})}catch{}}const A=f(""),F=f("");async function J(n){F.value=n;const t={lgnTypeCd:"03",signedVals:A.value,vidMsg:F.value,userId:k.value,rrno:e.rrno+"",encRrno:e.encRrno+"",bizNo:e.brno+""};try{const r=await S.authCertCheck(t);if(!r)i.value="검증 실패입니다.";else if(r.state==="success"){const c=await ke({loginTypeCd:"03",rrno:e.rrno||"",encRrno:e.encRrno||"",crno:e.crno||"",brno:e.brno||"",userNm:e.userNm||"",userDn:r.userDn});o.setRefreshUser(),m("auth-result",{success:!0,authMethod:"cert",message:c.message,rrno:e.rrno,encRrno:e.encRrno,crno:e.crno,brno:e.brno,userNm:e.userNm})}else r===void 0?i.value="검증 실패에 실패하였습니다.":i.value=r.message,d.value=!0}catch{i.value="인증에 실패하였습니다.",d.value=!0}}const S=ve(),k=f(""),d=f(!1),i=f(""),W=f(""),e=p,m=h,_=f(null),D=n=>n.preventDefault(),z=()=>{document.body.style.overflow="hidden",document.addEventListener("touchmove",D,{passive:!1})},E=()=>{document.body.style.overflow="",document.removeEventListener("touchmove",D)};pe(()=>e.visible,async n=>{var t;n?(z(),await Ce(),(t=b.value)==null||t.focus()):E()});function T(n){n.key==="Tab"&&q(n)}function q(n){if(!b.value)return;const t=["a[href]","area[href]","input:not([disabled])","select:not([disabled])","textarea:not([disabled])","button:not([disabled])",'[tabindex]:not([tabindex="0"])'],r=b.value.querySelectorAll(t.join(","));if(!r.length)return;const c=r[0],l=r[r.length-1],u=n.shiftKey,a=document.activeElement;u&&a===b.value&&(n.preventDefault(),l.focus()),u&&a===c?(n.preventDefault(),l.focus()):!u&&a===l&&(n.preventDefault(),c.focus())}he(async()=>{document.addEventListener("keydown",T)}),ge(()=>{E(),document.removeEventListener("keydown",T),S.removeScriptj()});function H(n=!1){d.value=n}async function Y(){var n;v("true"),(((n=o.sessionInfo)==null?void 0:n.user.userDtlSeCd)+"").startsWith("USRTC3")?(i.value="법인은 간편인증을 사용할 수 없습니다.",d.value=!0,y()):(y(),B())}async function G(){v("true"),await S.init(),y();try{ce()}catch(n){let t="공동인증 실패입니다.";n instanceof Error&&(t=n.message),m("auth-result",{success:!1,authMethod:"cert",message:t,rrno:e.rrno,encRrno:e.encRrno,crno:e.crno,brno:e.brno,userNm:e.userNm})}}async function Q(){v("true"),y(),X()}async function X(){var n;(n=_.value)==null||n.openModal()}async function Z(n){if(!n.result)return;const t={ihidnum:n.ihidnum,name:n.name,birth:n.birth,ci:n.ci};try{if(t.ihidnum===e.rrno){const r=await Ne({loginTypeCd:"05",rrno:e.rrno||"",encRrno:e.encRrno||"",crno:e.crno||"",brno:e.brno||"",userNm:e.userNm||"",userCi:t.ci});o.setRefreshUser(),m("auth-result",{success:!0,authMethod:"mobile",message:r.message,rrno:e.rrno,encRrno:e.encRrno,crno:e.crno,brno:e.brno,userNm:e.userNm})}else i.value="주민번호 검증에 실패하였습니다.",d.value=!0}catch{}}function ee(n){}async function ne(){v("true"),y();try{try{e.brno?(await se(),await ae(),await ie()):(await te(),await re(),await oe())}catch(n){n instanceof Error}}catch(n){let t="공동인증 실패입니다.";n instanceof Error&&(t=n.message),m("auth-result",{success:!1,authMethod:"cert",message:t,rrno:e.rrno,encRrno:e.encRrno,crno:e.crno,brno:e.brno,userNm:e.userNm})}}async function te(){if(window.FinCert)return;const n=new Date,t=`${n.getFullYear()}${String(n.getMonth()+1).padStart(2,"0")}${String(n.getDate()).padStart(2,"0")}`,r=document.createElement("script");r.src=`https://4user.yeskey.or.kr/v1/fincert.js?dt=${t}`,await new Promise((c,l)=>{r.onload=()=>c(),r.onerror=()=>l(new Error("금융 인증서 스크립트 로드 실패")),document.body.appendChild(r)})}async function re(){if(!window.FinCert)throw new Error("FinCertPersonal SDK가 로드되지 않았습니다.");await new Promise((n,t)=>{window.FinCert.Sdk.init({orgCode:P,apiKey:j,lang:"kor",success:()=>n(),fail:r=>{t(new Error(`초기화 실패: ${r.code||"Unknown"}: ${r.message||"No message"}`))}})})}async function oe(){if(!window.FinCert)return;const n=["test"];window.FinCert.Sdk.sign({signFormat:{type:"CMS",CMSInfo:{ssn:"dummy"}},content:{binary:{binaries:n}},algorithms:"RSASSA-PKCS1-v1_5_SHA256",view:{lastAccessCert:!1,oid:{"1.2.410.200005.1.1.1.10":!0}},info:{signType:"01"},success:async t=>{var u;const r=((u=t.signedVals)==null?void 0:u[0])||"",c=x(),l={lgnTypeCd:"04",signedVals:r,userId:k.value,rrno:e.rrno+"",encRrno:e.encRrno+"",bizNo:""};try{const a=await c.authFinVidCheck(l);if(!a)i.value="검증에 실패하였습니다.";else if(a.state==="success"){const N=await O({loginTypeCd:"04",signedVals:"aa",rrno:e.rrno||"",encRrno:e.encRrno||"",crno:e.crno||"",brno:e.brno||"",userNm:e.userNm||"",userDn:a.userDn});o.setRefreshUser(),m("auth-result",{success:!0,authMethod:"finance",message:N.message,rrno:e.rrno,encRrno:e.encRrno,crno:e.crno,brno:e.brno,userNm:e.userNm})}else a===void 0?i.value="주민번호 검증 실패에 실패하였습니다.":i.value=a.message,d.value=!0}catch{i.value="인증에 실패하였습니다.",d.value=!0}},fail(t){}})}async function se(){if(window.FinCertCorp)return;const n=new Date,t=`${n.getFullYear()}${String(n.getMonth()+1).padStart(2,"0")}${String(n.getDate()).padStart(2,"0")}`,r=document.createElement("script");r.src=`https://4user.yeskey.or.kr/v1/fincertCorp.js?dt=${t}`,await new Promise((c,l)=>{r.onload=()=>c(),r.onerror=()=>l(new Error("금융 인증서 스크립트 로드 실패")),document.body.appendChild(r)})}async function ae(){if(!window.FinCertCorp)throw new Error("FinCertPersonal SDK가 로드되지 않았습니다.");await new Promise((n,t)=>{window.FinCertCorp.Sdk.init({orgCode:P,apiKey:j,lang:"kor",success:()=>n(),fail:r=>{t(new Error(`초기화 실패: ${r.code||"Unknown"}: ${r.message||"No message"}`))}})})}async function ie(){if(!window.FinCertCorp)return;const n=["test"];window.FinCertCorp.Sdk.sign({signFormat:{type:"CMS",CMSInfo:{ssn:"dummy"}},content:{binary:{binaries:n}},algorithms:"RSASSA-PKCS1-v1_5_SHA256",view:{lastAccessCert:!1,oid:{"1.2.410.200005.1.1.1.10":!0}},info:{signType:"01"},success:async t=>{var u;const r=((u=t.signedVals)==null?void 0:u[0])||"",c=x(),l={lgnTypeCd:"04",signedVals:r,userId:k.value,rrno:"",encRrno:"",bizNo:e.brno+""};try{const a=await c.authFinVidCheck(l);if(!a)i.value="검증에 실패하였습니다.";else if(a.state==="success"){const N=await O({loginTypeCd:"04",signedVals:"aa",rrno:e.rrno||"",encRrno:e.encRrno||"",crno:e.crno||"",brno:e.brno||"",userNm:e.userNm||"",userDn:a.userDn});o.setRefreshUser(),m("auth-result",{success:!0,authMethod:"finance",message:N.message,rrno:e.rrno,encRrno:e.encRrno,crno:e.crno,brno:e.brno,userNm:e.userNm})}else a===void 0?i.value="주민번호 검증 실패에 실패하였습니다.":i.value=a.message,d.value=!0}catch{i.value="인증에 실패하였습니다.",d.value=!0}},fail(t){}})}function ce(){const n=window.Sign_with_vid_user;n&&n(12,"이 내용이 전자서명됩니다.",we,async t=>{A.value=t,typeof send_vid_info=="function"&&send_vid_info(J)})}function y(){const n=document.getElementById("layerModal_01");n&&n.classList.remove("on");const t=document.querySelector(".iw-modal.over");t&&t.classList.remove("over"),m("close-modal")}return(n,t)=>{const r=le;return R(),U(be,null,[e.visible?(R(),U("div",Re,[s("div",Me,[s("div",{ref_key:"modalRef",ref:b,class:"modal-dialog",tabindex:"0"},[t[6]||(t[6]=s("div",{class:"modal-header"},[s("h2",{class:"modal-title"}," 인증서 선택 ")],-1)),s("div",{class:"modal-body"},[s("div",{class:"section-4"},[t[4]||(t[4]=s("p",{class:"title xlg"},[s("span",{class:"block"},"인증이 필요한 서비스입니다."),s("span",{class:"block"},"인증방식을 선택하세요.")],-1)),s("div",{class:"select-certificate row"},[s("button",{type:"button",class:"btn-type",onClick:Q},t[0]||(t[0]=[s("i",{class:"iconset lg ico-certification-mobile"},null,-1),w("모바일 신분증 ")])),s("button",{type:"button",class:"btn-type",onClick:Y},t[1]||(t[1]=[s("i",{class:"iconset lg ico-certification-simple"},null,-1),w("간편인증 ")])),s("button",{type:"button",class:"btn-type",onClick:G},t[2]||(t[2]=[s("i",{class:"iconset lg ico-certification-official"},null,-1),w("공동인증서 ")])),s("button",{type:"button",class:"btn-type",onClick:ne},t[3]||(t[3]=[s("i",{class:"iconset lg ico-certification-finanace"},null,-1),w("금융인증서 ")]))])])]),s("button",{type:"button",class:"btn-close-modal",onClick:y},t[5]||(t[5]=[s("span",{class:"sr-only"},"닫기",-1)]))],512)])])):V("",!0),$(r,{ref_key:"simpleCertModal",ref:g,onAuthSuccess:K,onAuthFail:I},null,512),$(de,{ref_key:"mobileCertModal",ref:_,onAuthSuccess:Z,onAuthFail:ee},null,512),M(d)?(R(),ye(ue,{key:1,"popup-message":M(i),"popup-togo":M(W),onShowAlertPopup:H},null,8,["popup-message","popup-togo"])):V("",!0)],64)}}});export{Ue as _,Se as a,Ne as b,ke as c};
